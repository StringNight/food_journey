# 前端更新说明：处理后端详细错误信息

我们已经更新了后端的错误响应格式，使其能够返回更详细的验证错误信息。为了在前端正确显示这些错误信息，需要进行以下更新：

## 已完成的修改

1. 更新了 `AuthModels.swift` 中的 `ErrorResponse` 模型，使其能够解析新的错误响应格式：
   - 添加了 `type` 和 `errors` 字段
   - 添加了 `ValidationError` 结构体来解析具体错误信息

2. 更新了 `NetworkService.swift` 中的错误处理逻辑：
   - 添加了对 422 验证错误的专门处理
   - 添加了 `NetworkError.LocalizedError` 扩展以提供本地化错误描述

## 如何应用更新

1. 打开 Xcode 项目，使用 Cursor 生成的代码更新上述文件
2. 清理并重新构建项目 (Product > Clean Build Folder，然后 Product > Build)
3. 运行应用程序并测试注册功能

## 测试建议

测试以下场景，确保错误信息正确显示：

1. 使用不符合规则的密码注册（例如缺少大写字母、小写字母、数字或特殊字符）
2. 使用已存在的用户名注册
3. 使用不符合规则的用户名注册（例如包含特殊字符）

## 后端错误格式示例

当验证失败时，后端现在会返回以下格式的错误：

```json
{
  "detail": "输入数据验证失败",
  "type": "validation_error",
  "errors": [
    {
      "field": "password",
      "field_path": "body.password",
      "message": "密码必须包含至少一个大写字母",
      "type": "value_error"
    }
  ]
}
```

## 新的API端点更新

### 多组训练记录功能

我们添加了一个新的API端点，用于快速记录多组相同参数的训练数据：

```
POST /api/v1/profile/exercise/multi-sets
```

这个API端点允许用户一次性记录多组相同重量和重复次数的训练数据。当用户执行如"3组10次，每组60kg的硬拉"这样的训练时，可以使用此API。

**请求示例：**

```json
{
  "exercise_name": "硬拉",
  "exercise_type": "力量",
  "num_sets": 3,
  "reps": 10,
  "weight": 60.0,
  "calories_burned": 150.5,
  "notes": "记录3组10次，每组60kg的硬拉",
  "recorded_at": "2024-01-11T15:30:00Z"
}
```

**前端实现建议：**

1. 在训练记录页面添加一个"快速记录多组"选项
2. 提供以下输入字段：
   - 训练名称（下拉列表）
   - 训练类型（下拉列表：力量、有氧、拉伸、其他）
   - 组数（数字输入）
   - 每组重复次数（数字输入）
   - 重量（数字输入，带单位选择kg/lb）
   - 消耗卡路里（可选，数字输入）
   - 备注（文本框）
   - 记录时间（日期时间选择器，默认为当前时间）
3. 点击"保存"按钮时，将数据发送到新的API端点

**UI设计建议：**

提供两种记录模式：
1. 详细模式 - 使用现有的 `/api/v1/profile/exercise` 端点，允许记录每组不同的参数
2. 快速模式 - 使用新的 `/api/v1/profile/exercise/multi-sets` 端点，适用于多组相同参数的情况

对于力量训练，快速模式通常更加适用，可以设为默认选项。

## 联系方式

如果在应用更新时遇到任何问题，请联系后端开发团队。
